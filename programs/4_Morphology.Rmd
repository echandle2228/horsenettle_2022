---
title: "Morphology Analysis"
author: "Emma Chandler"
date: "3/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
remove(list = ls())
```

Load Libraries
```{r}
library(ggplot2)
library(lmerTest)
library(dplyr)
```

Load Data
```{r}
morph <- read.csv("~/horsenettle_2022/data/flower_traits.csv", header = TRUE)

```

# Creating a figure theme for all plots
```{r}
HStheme <- function(){            
  theme_bw()+                          
  theme(axis.text.x = element_text(size = 12), 
        text = element_text(family = "sans"), 
        axis.text.y = element_text(size = 12),
        plot.subtitle = element_text(size = 16, vjust = 1, hjust = 0.5),
        axis.title = element_text(size = 14),
        panel.grid = element_blank(),
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), units = , "cm"),
        plot.title = element_text(size = 20, vjust = 1, hjust = 0.5),
        legend.text = element_text(size = 12),
        legend.title = element_blank())
}
```

Pistil Length
```{r}

# Difference between North and South for control
Control <- morph %>% filter(Treatment == "Control")


  
pistil.m <- lmer(style_length ~ Region + Population + (1|Population:ID), data = Control)

(pistil.m.a <- anova(pistil.m))
(pistil.m.r <- ranova(pistil.m))


ggplot(Control, aes(x = Region, y = style_length, fill = Region)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Stigma and Style Length")+
  scale_fill_manual(values = c("#104E8B", "#CD2626")) +
  HStheme()

# Saving graph
# ggsave("figures/styleLength.png", width = 7, height = 5, dpi = 300)




# Northern plants difference between treatments

North <- morph %>% filter(Region == "North")

Npistil.m <- lmer(style_length ~ Treatment + Population + (1|Population:ID), data = North)

(Npistil.m.a <- anova(Npistil.m))
(Npistil.m.r <- ranova(Npistil.m))


# Style Length
ggplot(North, aes(x = Treatment, y = style_length, fill = Treatment)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Stigma and Style Length")+
  scale_fill_manual(values = c("#474747", "#FF3030")) +
  HStheme()

# Saving graph
# ggsave("figures/styleLength2.png", width = 7, height = 5, dpi = 300)




# Is there phenotypic plasticity
ggplot(North, aes(x = Treatment, y = style_length)) +
  HStheme() +
  stat_summary(aes(group = ID), fun = mean, geom = "line", size = 1, alpha = 0.7) +
  stat_summary(aes(group = ID), 
               geom = "errorbar",
               fun.data = mean_cl_boot,
               width = 0.1,size = 0.2) +
  stat_summary(fun = mean, geom = "point") +
  geom_point(size = 2) +
  labs(y = "Stigma and Style Length")+
  theme(legend.position = "none")
  

# Saving graph
# ggsave("figures/styleLength3.png", width = 7, height = 5, dpi = 300)

```


Stamen Length
```{r}

# Difference between North and South for control
stamen.m <- lmer(stamen_length ~ Region + Population + (1|Population:ID), data = Control)

(stamen.m.a <- anova(stamen.m))
(stamen.m.r <- ranova(stamen.m))


ggplot(Control, aes(x = Region, y = stamen_length, fill = Region)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Stamen Length")+
  scale_fill_manual(values = c("#104E8B", "#CD2626")) +
  HStheme()

# Saving graph
# ggsave("figures/stamenLength.png", width = 7, height = 5, dpi = 300)




# Northern plants difference between treatments
Nstamen.m <- lmer(stamen_length ~ Treatment + Population + (1|Population:ID), data = North)

(Nstamen.m.a <- anova(Nstamen.m))
(Nstamen.m.r <- ranova(Nstamen.m))


ggplot(North, aes(x = Treatment, y = stamen_length, fill = Treatment)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Stamen Length")+
  scale_fill_manual(values = c("#474747", "#FF3030")) +
  HStheme()

# Saving graph
# ggsave("figures/stamenLength2.png", width = 7, height = 5, dpi = 300)




# Is there phenotypic plasticity
ggplot(North, aes(x = Treatment, y = stamen_length)) +
  HStheme() +
  stat_summary(aes(group = ID), fun = mean, geom = "line", size = 1, alpha = 0.7) +
  stat_summary(aes(group = ID), 
               geom = "errorbar",
               fun.data = mean_cl_boot,
               width = 0.1,size = 0.2) +
  stat_summary(fun = mean, geom = "point") +
  geom_point(size = 2) +
  labs(y = "Stamen Length")+
  theme(legend.position = "none")
  

# Saving graph
# ggsave("figures/stamenLength3.png", width = 7, height = 5, dpi = 300)



```



Ovule Number
```{r}

# Difference between North and South for control
ovule.m <- lmer(ovule_number ~ Region + Population + (1|Population:ID), data = Control)

(ovule.m.a <- anova(ovule.m))
(ovule.m.a <- ranova(ovule.m))


ggplot(Control, aes(x = Region, y = ovule_number, fill = Region)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Ovule Number")+
  scale_fill_manual(values = c("#104E8B", "#CD2626")) +
  HStheme()

# Saving graph
# ggsave("figures/OvuleNum.png", width = 7, height = 5, dpi = 300)




# Northern plants difference between treatments
Novule.m <- lmer(ovule_number ~ Treatment + Population + (1|Population:ID), data = North)

(Novule.m.a <- anova(Novule.m))
(Novule.m.r <- ranova(Novule.m))


ggplot(North, aes(x = Treatment, y = ovule_number, fill = Treatment)) +
  geom_boxplot(alpha = 0.8) +
  labs(y = "Ovule Number")+
  scale_fill_manual(values = c("#474747", "#FF3030")) +
  HStheme()

# Saving graph
# ggsave("figures/OvuleNum2.png", width = 7, height = 5, dpi = 300)




# Is there phenotypic plasticity
ggplot(North, aes(x = Treatment, y = ovule_number)) +
  HStheme() +
  stat_summary(aes(group = ID), fun = mean, geom = "line", size = 1, alpha = 0.7) +
  stat_summary(aes(group = ID), 
               geom = "errorbar",
               fun.data = mean_cl_boot,
               width = 0.1,size = 0.2) +
  stat_summary(fun = mean, geom = "point") +
  geom_point(size = 2) +
  labs(y = "Ovule Number")+
  theme(legend.position = "none")
  

# Saving graph
# ggsave("figures/OvuleNum3.png", width = 7, height = 5, dpi = 300)

```




